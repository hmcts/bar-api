plugins {
    id 'io.spring.dependency-management' version '1.0.3.RELEASE'
    id 'org.owasp.dependencycheck' version '3.0.2'
    id 'org.sonarqube' version '2.6'
}

allprojects {
    group = 'uk.gov.hmcts.reform.bar'
    version = rootProject.file('version.txt').text.trim()
}

subprojects {
    apply plugin: 'maven'
    apply plugin: 'java'
    apply plugin: 'jacoco'
    apply plugin: 'io.spring.dependency-management'
    apply plugin: 'org.owasp.dependencycheck'
    apply plugin: 'application'

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    mainClassName = "uk.gov.hmcts.bar.api.BarServiceApplication"

    tasks.withType(JavaCompile) {
        options.encoding = 'UTF-8'
    }

    sonarqube {
        properties {
            property "sonar.exclusions", "**/**/data/model/*.java,**/BarServiceApplication.java,**/Error.java,**/ResourceNotFoundException.java,**/*Configuration.java,**/BaseRepository.java"
        }
    }

    project(":bar-client") {
        sonarqube {
            skipProject = true
        }
    }

    test {
        finalizedBy jacocoTestReport
    }

    dependencyCheck {
        failBuildOnCVSS = 0
        suppressionFile = 'dependency-check-suppressions.xml'
    }

    repositories {
        mavenLocal()
        maven { url 'http://artifactory.reform.hmcts.net/artifactory/libs-release' }
    }

    dependencies {
        compileOnly 'org.projectlombok:lombok:1.16.16'
        compileOnly 'com.google.code.findbugs:annotations:3.0.1'

        testCompile 'junit:junit:4.12'
        testCompile 'org.assertj:assertj-core:3.8.0'
        testCompile 'com.tngtech.java:junit-dataprovider:1.13.1'

    }

    dependencyManagement {
        imports {
            mavenBom 'org.springframework.boot:spring-boot-starter:1.5.9.RELEASE'
        }

        dependencies {
            dependency 'uk.gov.hmcts.reform:java-logging-spring:1.2.0'
            dependency 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.8.8'
            dependency 'com.google.guava:guava:22.0'

            dependency 'org.liquibase:liquibase-core:3.5.3'
            dependency 'org.postgresql:postgresql:9.4.1212'
            dependency 'org.hibernate:hibernate-validator:5.3.5.Final'

            dependency 'io.springfox:springfox-swagger2:2.6.0'
            dependency 'io.springfox:springfox-swagger-ui:2.6.0'
            dependency 'commons-beanutils:commons-beanutils:1.9.3'
        }
    }
}
